import{r as v,j as n}from"./index-BnDS7Jbj.js";function u(t,r){const s=new RegExp(`^${r}\\s*:\\s*(.+)$`,"im"),l=t.match(s);return l?l[1].trim():null}function b(t,r){const s=new RegExp(`^${r}\\s*:\\s*(.+)$`,"gim"),l=[];let a;for(;a=s.exec(t);)l.push(a[1].trim());return l}function F(t){if(!t)return null;const r=t.match(/<([^>]+)>/),s=r?r[1]:t,l=s.lastIndexOf("@");return l>-1?s.slice(l+1).toLowerCase():null}function $(t,r){const s=new RegExp(`${r}\\s*=\\s*([a-z]+)`,"i"),l=t.match(s);if(!l)return"missing";const a=l[1].toLowerCase();return["pass","fail","softfail","neutral","none"].includes(a)?a:"other"}function T(t){const r=u(t,"From"),s=u(t,"To"),l=u(t,"Subject"),a=u(t,"Date"),R=u(t,"Message-ID"),h=u(t,"Return-Path"),f=u(t,"Reply-To"),d=[...b(t,"Authentication-Results"),...b(t,"ARC-Authentication-Results")],j=b(t,"Received"),g=u(t,"X-MS-Exchange-Transport-Rules"),c=d.map(o=>$(o,"spf")).find(o=>o!=="missing")??"missing",m=d.map(o=>$(o,"dkim")).find(o=>o!=="missing")??"missing",e=d.map(o=>$(o,"dmarc")).find(o=>o!=="missing")??"missing",i=F(r),y=F(h),x=F(f),p=[];return g&&p.push({level:"средний",text:"Обнаружен заголовок X-MS-Exchange-Transport-Rules: письмо модифицировалось транспортными правилами."}),f&&x&&i&&x!==i&&p.push({level:"средний",text:"Домен Reply-To отличается от From: возможная переадресация ответа на сторонний адрес."}),h&&y&&i&&y!==i&&p.push({level:"низкий",text:"Return-Path отличается от домена From: допустимо в некоторых сценариях, требуется контекстная проверка."}),(c==="fail"||c==="softfail"||c==="neutral"||c==="none"||c==="missing")&&(m==="fail"||m==="neutral"||m==="none"||m==="missing")&&(e==="fail"||e==="missing"||e==="none"||e==="neutral")&&p.push({level:"высокий",text:"Признаки провала DMARC (ни SPF, ни DKIM не подтверждены для домена From)."}),(t.match(/x-forwarded-for/i)||g&&/redirect|forward/i.test(g))&&p.push({level:"средний",text:"Замечены признаки возможной переадресации: проверьте правила ящика и транспорта."}),j.length===0&&p.push({level:"средний",text:"Отсутствуют заголовки Received: анализ цепочки доставки затруднён."}),{fields:{from:r,to:s,subject:l,date:a,msgId:R,rpath:h,rto:f},auth:{spf:c,dkim:m,dmarc:e},counts:{received:j.length,authLines:d.length},findings:p}}function S(){const[t,r]=v.useState(""),[s,l]=v.useState(null),[a,R]=v.useState(!1),h=t.trim().length>0,f=h&&!a,d=(h||!!s)&&!a,j=v.useMemo(()=>{if(!s)return null;const{fields:e,auth:i,counts:y}=s;return[e.from?`From: ${e.from}`:null,e.to?`To: ${e.to}`:null,e.subject?`Subject: ${e.subject}`:null,e.date?`Date: ${e.date}`:null,e.msgId?`Message-ID: ${e.msgId}`:null,e.rpath?`Return-Path: ${e.rpath}`:null,e.rto?`Reply-To: ${e.rto}`:null,`SPF: ${i.spf}`,`DKIM: ${i.dkim}`,`DMARC: ${i.dmarc}`,`Получено (Received): ${y.received}`].filter(Boolean)},[s]);function g(){if(f){R(!0);try{const e=T(t);l(e)}finally{R(!1)}}}function c(){d&&(r(""),l(null))}function m(e){const i=e.target.files?.[0];if(!i)return;if(!/\.txt$|\.eml$/i.test(i.name)){alert("Допустимые форматы: .txt или .eml"),e.currentTarget.value="";return}const x=new FileReader;x.onload=()=>r(String(x.result||"")),x.readAsText(i)}return n.jsxs("div",{children:[n.jsx("h2",{children:"Header Check"}),n.jsx("p",{className:"hero-sub",style:{marginTop:0},children:"Цель: первичная проверка заголовков электронного письма на признаки подмены домена отправителя, некорректного прохождения SPF/DKIM/DMARC и применения транспортных правил."}),n.jsxs("div",{style:{margin:"10px 0 14px",fontSize:13,color:"#94a3b8"},children:["Данные: полный набор исходных заголовков сообщения (без тела). Допустимые форматы: ",n.jsx("code",{children:".txt"}),", ",n.jsx("code",{children:".eml"}),"."]}),n.jsxs("div",{style:{display:"grid",gap:8,marginBottom:12},children:[n.jsx("textarea",{value:t,onChange:e=>r(e.target.value),rows:12,placeholder:"Вставьте полный набор исходных заголовков (Received, Authentication-Results, Return-Path, From, Reply-To, Message-ID и др.).",style:{width:"100%",resize:"vertical",padding:10,borderRadius:10,border:"1px solid rgba(255,255,255,.10)",background:"var(--card)",color:"var(--text)",fontFamily:"ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",fontSize:13,lineHeight:1.45}}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsxs("label",{className:"btn ghost",style:{cursor:"pointer"},children:["Загрузить файл (.txt/.eml)",n.jsx("input",{type:"file",accept:".txt,.eml",onChange:m,style:{display:"none"}})]}),n.jsx("button",{className:"btn primary",onClick:g,disabled:!f,children:"Проанализировать"}),n.jsx("button",{className:"btn ghost",onClick:c,disabled:!d,title:"Очистить поле и результаты",children:"Очистить"})]})]}),s&&n.jsxs("div",{className:"card",style:{marginTop:12},children:[n.jsx("div",{className:"t",children:"Итоги проверки"}),n.jsx("ul",{style:{margin:"6px 0 10px",paddingLeft:18},children:j.map((e,i)=>n.jsx("li",{style:{marginBottom:4},children:e},i))}),n.jsx("div",{className:"t",style:{marginTop:10},children:"Замечания"}),s.findings.length===0?n.jsx("p",{style:{marginTop:6,color:"#94a3b8"},children:"Критичных индикаторов не выявлено по эвристикам прототипа."}):n.jsx("ul",{style:{margin:"6px 0 0",paddingLeft:18},children:s.findings.map((e,i)=>n.jsxs("li",{style:{marginBottom:6},children:[n.jsx("b",{style:{textTransform:"uppercase"},children:e.level}),": ",e.text]},i))})]}),n.jsx("p",{style:{marginTop:12,fontSize:12,color:"#94a3b8"},children:"Примечание: результаты носят учебный характер и не заменяют специализированные средства расследования."})]})}export{S as default};
